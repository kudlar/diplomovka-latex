%%
\section{Funkcia programu}

Program Mediátor je implementáciou aplikaèného rámca pre problém sprostredkovania správ v protokole IPFIX 
\emph{(IP Flow Information Export (IPFIX) Mediation Problem)} vyvíjaný výskumnou skupinou MONICA sídliacou
v Laboratóriu poèítaèových sietí \emph{(CNL)} na Technickej Univerzite v Ko¹iciach. Je súèas»ou meracej
architektúry SLAmeter, ktorej úlohou je pasívne meranie parametrov sie»ovej prevádzky na báze tokov. 
Na základe nameraných hodnôt urèuje triedu kvality slu¾ieb a Internetového pripojenia poskytovateµov 
Internetu. Trieda kvality vypovedá o dodr¾iavaní zmluvy o úrovni poskytovanej slu¾by - \emph{SLA}.

Komponentmi architektúry IPFIX (IP Flow Information Export) podµa RFC 5470 \citep{rfc5470}
sú exportéry a kolektory komunikujúce protokolom IPFIX.
Vzhµadom k trvalému rastu IP prevádzky v heterogénnych sie»ových prostrediach,
tieto exportér-kolektor systémy mô¾u vies» k problémom ¹kálovateµnosti. Naviac,
neposkytujú flexibilitu potrebnú pre ¹iroký rad meracích aplikácii.

Sprostredkovateµské moduly Mediátora mô¾u z pohµadu manipulácie s dátami poskytova» agregáciu, koreláciu,
filtrovanie, anonymizáciu 
a iné úpravy záznamov o tokoch za úèelom ¹etrenia výpoètových zdrojov meracieho systému a vykonávania 
predspracovania úloh pre kolektor. Z hµadiska interoperability nástrojov rôznych vývojárov, mô¾u 
poskytova» konverziu z iných protokolov na IPFIX, respektíve zvy¹ova» spoµahlivos» exportov
napríklad prevodom z nespoµahlivého, bezspojovo orientovaného protokolu UDP na spoµahlivý SCTP. 

Program bol v roku 2013 vytvorený Rastislavom Kudlom v rámci jeho diplomovej práce.



\section{Analýza problému}

Problematika sprostredkovania IPFIX správ je podrobne spracovaná v \citep{rfc5982}. 
Hovori o tom, ¾e sie»oví administrátori èasto celia problémom týkajúcim sa ¹kálovateµnosti meracieho 
systému, flexibility monitorovania na základe tokov, alebo aj spoµahlivosti exportovania.
Napriek tomu, ¾e sa vyvinuli známe techniky ako \emph{vzorkovanie a filtrovanie  paketov}, \emph{zoskupovanie 
dátových záznamov}, alebo \emph{replikácia exportu}, tieto problémy nevymizli.
Pozostávajú z prispôsobovania niektorých parametrov meracích nástrojov zdrojom meracieho 
systému zatiaµ èo musia naplni» patrièné podmienky ako sú \emph{presnos» nameraných dát}, \emph{granularita 
toku}, èi \emph{spoµahlivos» exportu}. Tieto okolnosti závisia na dvoch faktoroch:
\begin{enumerate}
 \item \textbf{Kapacita  meracieho systému} - pozostáva zo ¹írky pásma  spravovanej siete, kapacity 
 úlo¾iska a výkonu exportovacích a zhroma¾ïovacích nástrojov
 
 \item \textbf{Po¾iadavky aplikácie} - rôzne aplikácie vy¾adujú rôznu zrnitos» záznamov o tokoch a presnos» dát.
\end{enumerate}


\subsection{Vybrané príklady pou¾itia sprostredkovania správ} \label{sec:mediator_examples}

RFC 5982 \citep{rfc5982} uvádza viacero príkladov zaradenia IPFIX Mediátora do klasickej
exportér - kolektor architektúry. Uveïme aspoò niektoré:
\begin{itemize}
  \item prispôsobovanie granularity tokov,
  \item distribuovaná zhroma¾ïovacia infra¹truktúra,
  \item spájanie èasu,
  \item spájanie priestoru,
\begin{itemize}
  \item spájanie priestoru v rámci jednej pozorovacej domény,
  \item spájanie priestoru viacerých pozorovacích domén jedného exportéra,
  \item spájanie priestoru niekoµkých exportérov,
  \item spájanie priestoru administratívnych domén,
\end{itemize}
  \item anonymizácia dátových záznamov,
  \item distribúcia dátových záznamov,
  \item konverzia z protokolu ni¾¹ej verzie na IPFIX,
\end{itemize}



\subsection{Analýza aplikaèného rámca pre IPFIX Mediátor} 

\begin{figure}[ht!]
\centering
\includegraphics[width=0.9\textwidth]{mediation_reference_model}
\caption{Referenèný model sprostredkovania správ v IPFIX}\label{o:mediation_reference_model}
\end{figure}

Analýze aplikaèného rámca pre sprostredkovanie správ v IPFIX sa venuje RFC 6183 \citep{rfc6183}. 
Na Obrázku \ref{o:mediation_reference_model} je zobrazený referenèný model sprostredkovania správ v IPFIX 
ako roz¹írenie referenèného modelu IPFIX, popísaného v \emph{Architecture for IP Flow Information Export} 
\citep{rfc5470}. Táto schéma zobrazuje mo¾né scenáre, ktoré mô¾u existova» v meracej architektúre.



Funkèné komponenty v rámci ka¾dej entity sú ohranièené zátvorkami []. Mediátor mô¾e prijíma» 
záznamy o toku od iných mediátorov a exportérov a prúd záznamov z iných zdrojov.
Za iné zdroje sa pova¾ujú nástroje iných protokolov, ako napríklad NetFlow exportéry \citep{rfc3954}. 
Spracovane dáta vo forme záznamov o toku potom exportuje jednému alebo viacerým kolektorom a mediátorom.

\begin{figure}[ht!]
\centering
\includegraphics[width=0.7\textwidth]{mediator_component_model}
\caption{Zjednodu¹ený model komponentov IPFIX Mediátora}\label{o:mediator_component_model}
\end{figure}

Zjednodu¹ený model komponentov IPFIX mediátora je predstavuje Obrázok \ref{o:mediator_component_model}. 
Mediátor obsahuje jeden alebo viac sprostredkovateµských procesov, hierarchicky ulo¾ených 
medzi jedným alebo viacerými exportovacími a zhroma¾ïovacími procesmi. Tento model sa týka 
najbe¾nej¹ieho prípadu, kedy mediátor prijíma dátové záznamy od exportéra, alebo iného mediátora.

Sprostredkovateµské procesy sú kµúèovými funkènými blokmi sprostredkovania správ v IPFIX. Musia pokry» 
ka¾dý príklad pou¾itia sprostredkovania správ z kapitoly \ref{sec:mediator_examples}. 
Mediátor je schopný súèasne podporova» viac ako jeden sprostredkovateµský proces. 
\begin{itemize}
 \item \textbf{Paralelné spracovanie} - Prúd záznamov je spracovaný viacerými sprostredkovateµskými procesmi 
 paralelne. V tomto scenári, ka¾dý sprostredkovateµský proces dostáva kópiu celého prúdu záznamov ako vstup.
 \item \textbf{Sériové spracovanie} - Sprostredkovateµské procesy sú zapojene sériovo. Výstupný prúd 
 záznamov jedného procesu je vstupným prúdom nasledujúceho.
\end{itemize}

%--------------------------------------------

\clearpage

\section{Popis programu}

Jednotlivé èasti programu sú umiestnené v~nasledujúcich balíkoch:

\begin{itemize}
\item \verb|sk.tuke.cnl.bm.Mediator.collecting| - implementácia zhroma¾ïovacieho procesu
\item \verb|sk.tuke.cnl.bm.Mediator.exporting| - implementácia exportovacieho procesu
\item \verb|sk.tuke.cnl.bm.Mediator.IntermediateProcesses| - triedy tvoriace podporu pre sprostredkovateµské 
procesy. Hlavne triedy nových modulov musia by» umiestnené v tomto balíku!
\item \verb|sk.tuke.cnl.bm.Mediator.IPFIX| - triedy s~manuálnou implementáciou protokolu IPFIX
\item \verb|sk.tuke.cnl.bm.Mediator.exceptions| - vlastné výnimky aplikácie
\item \verb|sk.tuke.cnl.bm.Mediator| - hlavné triedy samotného programu
\end{itemize}



\subsection{Popis rie¹enia}


%V~prvom rade bolo potrebné umo¾ni» podporu viacerých záznamov v~sade. Trieda NetXMLParser bola rozdelená na dve samostatné jednotky. Jednou je vlákno UDPProcessor, ktorého úlohou je vybera» údaje z~PacketCache a èas» spracovania bole prepísaná do novej triedy IpfixParser. Parsovanie IPFIX správ bolo  zoptimalizované a upravené do prehµadnej podoby. Celkový problém bol rozdelený na men¹ie úlohy, ktoré sú realizované metódami na parsovanie správy, sady, a v¹etkých druhov záznamov. V~metóde slú¾iacej na spracovanie sady bol pre ka¾dý druh sady pridaný cyklus, ktorý vyberá záznamy zo sady, a¾ kým sa pozícia v~buffri nedostane na koniec sady.
%
%Dekódovanie dát jednotlivých informaèných elementov bolo presunuté do samostatnej  triedy. Podobne ako v~triede IpfixParser je volaná jedna metóda, ktorá na základe dátového typu presunie spracovanie na metódy zaoberajúce sa danou skupinou dátových typov. Údaje z~buffra pre dátový typ octetArray sú prevedené do podoby re»azce v~kódovaní Base64 aby ich bolo mo¾né ulo¾i» v~databáze. Bajt v~buffri pre dátový typ boolean je interpretovaný ako true pri hodnote 1 a ako false pri hodnote 0. V¹etky ostatné hodnoty znamenajú chybu a je to oznámené volajúcej metóde výnimkou DataException. Okrem implementácie dekódovania dátového typu macAddres bola e¹te opravená interpretácia dátových typov dateTimeMicroseconds a dateTimeNanoseconds. Keï¾e sa tieto hodnoty musia zmesti» do ôsmich bajtov vo formáte NTP Timestamp a analyzujúce aplikácie sú postavené na technológii Java, ktorá nepozná bezznamienkové typy, je vhodné ulo¾i» tieto hodnoty v~nezmenenej podobe ako znamienkové 64-bitové èíslo (long). Po získaní èísla 
%z~databázy je mo¾né jednoducho pou¾i» triedu Timestamp z~kni¾nice Apache Commons Net na jednoduch¹iu prácu s~touto èasovou známkou.
%
%Na podporu redukovaného kódovania bola vytvorená metóda handleReducedSizeEncoding(), ktorá zo skráteného informaèného elementu vytvorí buffer plnej veµkosti, ktorý je mo¾né be¾ným spôsobom interpretova». Pre bezznamienkové èísla sa do plnej veµkosti zµava doplnia nulové bajty. Pre záporné znamienkové èísla sa doplnia bajty o~hodnote 255, aby sa zachovala hodnota èísla. Redukovaný mô¾e by» aj dátový typ float64, a to pou¾itím polovièného poètu bajtov. Vtedy sa dáta interpretujú ako float32.
%
%Organizáciou definované informaèné elementy sú definované v~súbore ipfixFields.xml. Aby sa uva¾ovalo èíslo organizácie pre informaèné elementy, musela by» doplnená trieda IpfixElements o~mo¾nos» evidencie informaèných elementov nielen na základe ich identifikátora, ale súèasne s~èíslom organizácie (¹tandardné informaèné elementy sú uva¾ované s~èíslom organizácie 0). Spoloène s~tým v¹etky metódy slú¾iace na prístup k~informáciám o~informaèných elementoch museli by» roz¹írené o~parameter èísla organizácie.
%
%Variabilné informaèné elementy boli implementované v~triede IpfixParser. Pri výbere informaèného elementu, ktorého veµkos» je v~zázname ¹ablóny definovaná ako 65535 je vybratý prvý bajt z~dátovej èasti na aktuálnej pozícii. Ak je tento bajt men¹í ako 255, je vybraných toµko bajtov z~buffra, koµko tento bajt uvádza. Ak má bajt hodnotu 255, då¾ka je získaná z~ïal¹ích dvoch bajtov.
%
%Súèas»ou zmien v~parseri je detekcia po¹kodených správ. Ak je skutoèná veµkos» správy iná ako sa uvádza v~hlavièke, ide o~chybu. Pri ka¾dej chybe je vyhodená výnimka DataFormatException. Chyba je indikovaná aj keï je poèet zostávajúcich bajtov v~buffri men¹í ako veµkos» sady. Pri výbere údajov z~dátového záznamu alebo záznamu ¹ablóny sa testuje náraz na pravú hranicu sady. V~prípade jej dosiahnutia sa tie¾ ohlási chyba.
%
%Na pridanie podpory expirácie ¹ablón musela sa do záznamu ¹ablóny prida» polo¾ka èasu príchod ¹ablóny. Cache bola sprehµadnená a pred parsovaním
%dátového záznamu je overovaná platos» ¹ablóny. V~prípade ak je neplatná, dátová sada sa preskoèí. Ka¾dých 10 minút sa spú¹»a èistiace vlákno, aby vymazalo expirované ¹ablóny a zabránilo tak zaplòovaniu pamäte JXColl.
%Transportné protokoly TCP a SCTP pou¾ívajú vlastnú cache na uschovanie ¹ablón s~platnos»ou len pre konkrétne pripojenie, resp. asociáciu.
%Umo¾òená bola podpora pre zru¹enie ¹ablón pomocou Template Withdrawal správ. V~prípade, ak exportér po¹le u¾ kolektorom evidovanú ¹ablónu, alebo ak ru¹í neexistujúcu ¹ablónu, spojenie, resp. asociácia sa preru¹í. 
%
%Protokoly TCP a SCTP vyu¾ívajú na ka¾dé pripojenie samostatné vlákno. Obidva protokoly poèúvajú na nakonfigurovanom porte a poèet pripojení, resp. asociácií je ohranièený nastavením v~konfiguraènom súbore. Na podporu protokolu SCTP bolo potrebné prejs» na nov¹iu verziu Javy 1.7.




\clearpage
\section{Popis tried, èlenských premenných a~metód}

Keï¾e niektoré triedy Mediátora sú kvôli jednotnosti rie¹ení v rámci výskumnej skupiny MONICA toto¾né 
s triedami nastroja JXColl, v~nasledujúcich èastiach budú uvedené len tie, ktoré sa týkajú výhradne 
Mediátora. Popis ostatných tried a~metód je uvedený v~systémovej príruèke programu 
JXColl \citep{jxcoll_sp}.  

% ----------HLAVNÝ BALÍK --------------------------------------

\subsection{Balík sk.tuke.cnl.bm.Mediator}

\subsubsection{Trieda Default}
Trieda predstavuje rozhranie obsahujúce východiskové hodnoty konfiguraèného súboru. Neobsahuje kon¹truktor
ani ¾iadne metódy, iba verejne prístupné statické kon¹tanty.



\subsubsection{Trieda DropsCounter}
Slú¾i na výpoèet ¹tatistiky zahodených entít. Pod entitou sa myslia záznamy o tokoch, dátové záznamy, 
alebo IPFIX pakety. Obsahuje len statické metódy.

\bigskip
\textbf{Metódy} 

\textit{public static void \textbf{inputBufferDropsUP}()}

Zvy¹uje poèet strát spôsobených preplnením vstupného buffera sprostredkovateµských procesov o jeden. \\
\textbf{Parametre:} \\
\emph{String} processName - meno procesu


\textit{public static void \textbf{exportCacheDropsUP}()}

Zvy¹uje poèet strát spôsobených \verb|ExportCache| o jeden.\\


\textit{public static void \textbf{encodingDropsUp}()}

Zvy¹uje poèet strát spôsobených chybou pri kódovaní o jeden.\\


\textit{public static void \textbf{decodingDropsUp}()}

Zvy¹uje poèet strát spôsobených chybou pri dekódovaní o jeden.\\


\textit{public static void \textbf{packetDropsUp}()}

Zvy¹uje poèet IPFIX paketov zahodených UDP serverom o jeden.\\


\textit{public static void \textbf{printStats}()}

Vypí¹e ¹tatistiku v¹etkých zahodených entít.



\subsubsection{Trieda FlowRecordDispatcher}
Úlohou tejto triedy je na základe konfiguraèného súboru distribuova» prijaté záznamy o toku 
sprostredkovateµským procesom (sériovo alebo paralelne) a exportovaciemu procesu. Distribúcia prebieha
v súlade s IPFIX Mediator Framework (RFC 6183). Táto trieda je implementovaná podµa návrhového vzoru 
\emph{Singleton}.

\bigskip
\textbf{Metódy} 

\textit{public static FlowRecordDispatcher \textbf{getInstance}()}

Implementuje vzor \emph{Singleton}. Vytvorí a vráti jedineènú in¹tanciu v prípade ¾e neexistuje, v 
opaènom prípade ju iba vráti. \\
\textbf{Návratová hodnota:} \\
Jedineèný objekt typu \verb|FlowRecordDispatcher|.\\


\textit{public synchronized void \textbf{dispatchFlowRecord}(IPFIXFlowRecord flowRecord, String inputProcess)}

Posiela prijaté záznamy o tokoch príslu¹ným sprostredkovateµským procesom, alebo exportovaciemu procesu 
podµa konfigurácie. Najprv získa zoznam prijímateµov toku na základe mena pôvodcu. Ak je zoznam prázdny - 
záznam o toku je 
urèený na export, preto ho zapí¹e do \verb|ExportCache|. Ak zoznam nie je prázdny, získa si in¹tancie 
prijímateµov toku a záznam im zapí¹e do vstupného buffera. Táto metóda je synchronizovaná, lebo je
prístupná viacerým vláknam. \\
\textbf{Parametre:} \\
\emph{IPFIXFlowRecord} flowRecord - záznam o toku, ktorý sa má distribuova» ïalej \\
\emph{String} inputProcess - meno pôvodcu záznamu o toku.\\

\textit{private void \textbf{fillInputBuffer}(AIntermediateProcess process, IPFIXFlowRecord flowRecord)}

Metóda, ktorá zapisuje záznamy o tokoch do vstupného buffera sprostredkovateµských procesov. V prípade
neúspechu sa zvý¹i poèítadlo v \verb|DropsCounter| a vypí¹e error. \\
\textbf{Parametre:} \\
\emph{AIntermediateProcess} process - in¹tancia sprostredkovateµského procesu. \\
\emph{IPFIXFlowRecord} flowRecord - záznam o toku, ktorý sa má zapísa».\\

\textit{private ArrayList$<$String$>$ \textbf{getReceiversList}(String inputDevice)}

Získava zoznam príjemcov záznamu o toku od zadaného pôvodcu toku. \\
\textbf{Parametre:} \\
\emph{String} inputDevice - pôvodca záznamu o toku \\
\textbf{Návratová hodnota:} \\
Zoznam príjemcov toku, typ \verb|ArrayList|.



\subsubsection{Trieda IPLoader}
Trieda je zodpovedná za dynamické naèítavanie sprostredkovateµských procesov definovaných v konfiguraènom
súbore. Implementuje návrhový vzor \emph{Singleton}.

\bigskip
\textbf{Metódy} 

\textit{public static IPLoader \textbf{getInstance}()}

Implementuje vzor \emph{Singleton}. Vytvorí a vráti jedineènú in¹tanciu v prípade ¾e neexistuje, v opaènom prípade 
ju iba vráti.\\


\textit{public void \textbf{loadProcesses}()}

Hlavná metóda triedy, dynamicky naèítava sprostredkovateµské moduly definované v konfiguraènom súbore. 
Najprv získa systémový \emph{classLoader}. V cykle prechádza zoznam sprostredkovateµských modulov. 
Ka¾dý re»azec obsahujúci meno prevedie na binárne meno (meno triedy vrátane balíèkov)  a pomocou 
classLoader-a získa jeho \verb|Class| objekt. Na základe tohto objektu získa jedineènú in¹tanciu 
modulu a keï¾e sa jedná o vlákno, spustí ho tak, ¾e zavolá jeho metódu \verb|start()|. \\
\textbf{Hád¾e:} \\
\verb|IPLoaderException| - V prípade akejkoµvek chyby, ktorá mô¾e nasta» pri vykonávaní metódy. Chyby, ktoré 
sú zachytávané sú typov:
\begin{itemize}
 \item \verb|SecurityException|
 \item \verb|ClassNotFoundException|
 \item \verb|IllegalAccessException|
 \item \verb|NoSuchMethodException|
 \item \verb|InvocationTargetException|
\end{itemize}



\subsubsection{Trieda Mediator}
Úlohou hlavnej triedy Mediátora je postupne spusti» v¹etky vlákna a procesy potrebné pre beh programu.
Najprv sa preèítajú a spracujú argumenty príkazového riadku. Program vie rozpoznáva» dva druhy 
argumentov. Prvým je cesta ku konfiguraènému súboru. Ak nie je zadaná, pou¾íva sa východiskový 
konfiguraèný súbor. Druhým argumentom mô¾e by» zadaná mo¾nos» \verb|--logtofile|. Vtedy sú v¹etky 
logovacie výstupy presmerované zo ¹tandardného výstupu do súboru.

Potom ako program naèíta v¹etky nastavenia z konfiguraèného súboru, spustí v¹etky svoje moduly - 
sprostredkovateµské procesy pomocou triedy \verb|IPLoader|. Nasleduje spustenie vlákna, ktoré prijíma 
IPFIX pakety prostredníctvom protokolu UDP a vlákna, ktoré ich spracováva. Hovoríme o \verb|UDPServer| 
a \verb|UDPProcessor|. Nakoniec je spustené exportovacie vlákno - \verb|UDPExporter|. Kedykoµvek keï 
nastane chyba je Mediátor korektne ukonèený a to tak, ¾e uvolní v¹etku pamä» a zastaví be¾iace vlákna. 
Rovnako je Mediátor zastavený po stlaèení kombinácie kláves \verb|Ctrl+c|.

\bigskip
\textbf{Metódy} 

\textit{public static void \textbf{main}(String[] args)}

Hlavná metóda triedy. \\
\textbf{Parametre:} \\
\emph{String[]} args - argumenty príkazového riadku.\\


\emph{public static void \textbf{stopMediator}()}

Metóda, ktorá korektne ukonèuje beh programu. Zastaví v¹etky spustené vlákna a uvoµní v¹etky druhy pamäte.\\

\clearpage
\emph{public static void \textbf{interruptThread}()}

Preru¹í vykonávanie vlákna. \\
\textbf{Parametre:} \\
\emph{Thread} thread - objekt vlákna, ktoré sa má zastavi».\\


\emph{private static void \textbf{loggingToFile}()}

Metóda, ktorá vykonáva logovanie do súboru namiesto ¹tandardného výstupu.



\subsubsection{Trieda Support}
Podporná trieda, ktorá obsahuje pomocné metódy potrebné pri de(kódovaní) a pri validácii formátu dát. 
Uvádzam iba vlastné metódy.

\bigskip
\textbf{Metódy} 


\emph{public static byte[] \textbf{byteToByteArray}(byte x)}

Konvertuje primitívny typ \emph{byte} na pole bytov v usporiadaní bytov Big Endian. \\
\textbf{Parametre:} \\
\emph{byte} x - hodnota, ktorá sa má zakódova». \\
\textbf{Návratová hodnota:} \\
Pole bytov, typ \emph{byte[]}. \\


\emph{public static byte[] \textbf{shortToByteArray}(short x)}

Konvertuje primitívny typ \emph{short} na pole bytov v usporiadaní bytov Big Endian. \\
\textbf{Parametre:} \\
\emph{short} x - hodnota, ktorá sa má zakódova». \\
\textbf{Návratová hodnota:} \\
Pole bytov, typ \emph{byte[]}. \\


\emph{public static byte[] \textbf{intToByteArray}(int x)}

Konvertuje primitívny typ \emph{int} na pole bytov v usporiadaní bytov Big Endian. \\
\textbf{Parametre:} \\
\emph{int} x - hodnota, ktorá sa má zakódova». \\
\textbf{Návratová hodnota:} \\
Pole bytov, typ \emph{byte[]}. \\


\emph{public static byte[] \textbf{longToByteArray}(long x)}

Konvertuje primitívny typ \emph{long} na pole bytov v usporiadaní bytov Big Endian. \\
\textbf{Parametre:} \\
\emph{long} x - hodnota, ktorá sa má zakódova». \\
\textbf{Návratová hodnota:} \\
Pole bytov, typ \emph{byte[]}. \\


\emph{public static byte[] \textbf{floatToByteArray}(float x)}

Konvertuje primitívny typ \emph{float} na pole bytov v usporiadaní bytov Big Endian. \\
\textbf{Parametre:} \\
\emph{float} x - hodnota, ktorá sa má zakódova». \\
\textbf{Návratová hodnota:} \\
Pole bytov, typ \emph{byte[]}. \\


\emph{public static byte[] \textbf{doubleToByteArray}(double x)}

Konvertuje primitívny typ \emph{double} na pole bytov v usporiadaní bytov Big Endian. \\
\textbf{Parametre:} \\
\emph{double} x - hodnota, ktorá sa má zakódova». \\
\textbf{Návratová hodnota:} \\
Pole bytov, typ \emph{byte[]}. \\


\emph{public static boolean \textbf{validateMAC}(String macAddress)}

Validuje formát MAC adresy. \\
\textbf{Parametre:} \\
\emph{String} macAddress - adresa, ktorej formát sa má overi». \\
\textbf{Návratová hodnota:} \\
\emph{true} - v prípade, ¾e je adresa v správnom formáte.\\
\emph{false} - opaène.





% ----------BALÍK IPFIX --------------------------------------

\subsection{Balík sk.tuke.cnl.bm.Mediator.IPFIX}

\subsubsection{Trieda IPFIXEncoder}
Trieda so statickými metódami slú¾iacimi na zakódovanie re»azcovej reprezentácie hodnôt informaèných
elementov na abstraktne dátové typy podµa RFC 5101 a RFC 5102. Je presným opakom triedy \verb|IPFIXDecoder|.


\bigskip
{\bfseries Metódy}


\textit{public static byte[] \textbf{encode}(String dataType, String value)}

Zakóduje hodnotu dátového typu do poµa bytov podµa ¹pecifikácie IPFIX.
Priamo nevykonáva zakódovanie, volá konkrétne metódy podµa kategórie dátového typu.\\
{\bfseries Parametre:}\\
\emph{String} dataType - re»azec definujúci dátový typ obsiahnutý v~bufferi.\\
\emph{String} value - samotné dáta, ktoré sú predmetom zakódovania\\
{\bfseries Návratová hodnota:} \\
Pole bytov reprezentujúce interpretovanú re»azcovú hodnotu na základe predaného typu. \\
{\bfseries Hád¾e:} \\
\verb|UnsupportedDataException| - Ak dátový typ nie je podporovaný\\
\verb|OutOfBoundsException| - Ak je hodnota mimo povoleného rozsahu\\
\verb|UnknownHostException| - Ak program nevie rozpozna» host, alebo IP adresu \\
\verb|DataException| - Ak je chyba v formáte kódovanej hodnoty vzhµadom na dátový typ\\



\textit{public static byte[] \textbf{encodeUnsignedIntegralType}(String dataType, String value)}

Zakóduje celoèíselné bezznamiekové dátové typy unsigned8, unsigned16, unsigned32, unsigned64 a unsigned128. \\
{\bfseries Parametre:}\\
\emph{String} dataType - re»azec definujúci dátový typ obsiahnutý v~bufferi.\\
\emph{String} value - samotné dáta, ktoré sú predmetom zakódovania\\
{\bfseries Návratová hodnota:} \\
Pole bytov reprezentujúce interpretovanú re»azcovú hodnotu na základe predaného typu. \\
{\bfseries Hád¾e:} \\
\verb|UnsupportedDataException| - Ak dátový typ nie je podporovaný\\
\verb|NumberFormatException| - Ak je chyba v formáte kódovanej hodnoty vzhµadom na dátový typ\\
\verb|OutOfBoundsException| - Ak je hodnota mimo povoleného rozsahu\\



\textit{public static byte[] \textbf{encodeSignedIntegralType}(String dataType, String value)}

Zakóduje celoèíselné znamienkové dátové typy signed8, signed16, signed32 a signed64. \\
{\bfseries Parametre:}\\
\emph{String} dataType - re»azec definujúci dátový typ obsiahnutý v~bufferi.\\
\emph{String} value - samotné dáta, ktoré sú predmetom zakódovania\\
{\bfseries Návratová hodnota:} \\
Pole bytov reprezentujúce interpretovanú re»azcovú hodnotu na základe predaného typu. \\
{\bfseries Hád¾e:} \\
\verb|UnsupportedDataException| - Ak dátový typ nie je podporovaný\\
\verb|NumberFormatException| - Ak je chyba v formáte kódovanej hodnoty vzhµadom na dátový typ\\




\textit{public static byte[] \textbf{encodeFloatType}(String dataType, String value)}

Zakóduje desatinné dátové typy float32 a float64. \\
{\bfseries Parametre:}\\
\emph{String} dataType - re»azec definujúci dátový typ obsiahnutý v~bufferi.\\
\emph{String} value - samotné dáta, ktoré sú predmetom zakódovania\\
{\bfseries Návratová hodnota:} \\
Pole bytov reprezentujúce interpretovanú re»azcovú hodnotu na základe predaného typu. \\
{\bfseries Hád¾e:} \\
\verb|UnsupportedDataException| - Ak dátový typ nie je podporovaný\\
\verb|NumberFormatException| - Ak je chyba v formáte kódovanej hodnoty vzhµadom na dátový typ\\




\textit{public static byte[] \textbf{encodeAddressType}(String dataType, String value)}

Zakóduje dátové typy obsahujúce adresy: ipv4Address, ipv6Address a macAddress. \\
{\bfseries Parametre:}\\
\emph{String} dataType - re»azec definujúci dátový typ obsiahnutý v~bufferi.\\
\emph{String} value - samotné dáta, ktoré sú predmetom zakódovania\\
{\bfseries Návratová hodnota:} \\
Pole bytov reprezentujúce interpretovanú re»azcovú hodnotu na základe predaného typu. \\
{\bfseries Hád¾e:}\\
\verb|UnsupportedDataException| - Ak dátový typ nie je podporovaný\\
\verb|UnknownHostException| - Ak program nevie rozpozna» host, alebo IP adresu \\
\verb|DataException| - Ak je chyba v formáte kódovanej hodnoty vzhµadom na dátový typ\\




\textit{public static byte[] \textbf{encodeBooleanType}(String value)}

Zakóduje boolean reprezentujúci pravdivostnú hodnotu.\\
{\bfseries Návratová hodnota:}\\
Pole bytov reprezentujúci pravdivostnú hodnotu, "true" alebo "false". \\
{\bfseries Hád¾e:} \\
\verb|OutOfBoundsException| - Ak je hodnota mimo povoleného rozsahu\\



\textit{public static byte[] \textbf{encodeStringType}(String value)}

Zakóduje re»azec v kódovaní UTF-8 do pole bytov.\\
{\bfseries Návratová hodnota:}\\
Pole bytov re»azca v~kódovaní UTF-8.\\



\textit{public static byte[] \textbf{encodeOctetArrayType}(String value)}

Re»azec v kódu Base64 prevedie na pole bytov.\\
{\bfseries Návratová hodnota:}\\
Pole bytov predstavujúce binárne dáta zakódované v~Base64. \\



\textit{public static byte[] \textbf{encodeDateTimeType}(String dataType, String value)}

Zakóduje dátové typy èasových známok: dateTimeSeconds, dateTimeMilliseconds, dateTimeMicroseconds a 
dateTimeNanoseconds do poµa bytov. \\
{\bfseries Parametre:}\\
\emph{String} dataType - re»azec definujúci dátový typ obsiahnutý v~bufferi.\\
\emph{String} value - samotné dáta, ktoré sú predmetom zakódovania\\
{\bfseries Návratová hodnota:}\\
Pole bytov reprezentujúce interpretovanú hodnotu re»azca na základe predaného typu.
Dátové typy dateTimeSeconds a dateTimeMilliseconds predstavujú poèet sekúnd, resp. milisekúnd od Unix 
epochy (00:00 1.1.1970 UTC).
Dátové typy dateTimeMicroseconds a dateTimeNanoseconds sú zakódované vo formáte èasovej známky NTP 
Timestamp.\\
{\bfseries Hád¾e:}\\
\verb|UnsupportedDataException| - Ak dátový typ nie je podporovaný\\
\verb|NumberFormatException| - Ak je chyba v formáte kódovanej hodnoty vzhµadom na dátový typ\\
\verb|OutOfBoundsException| - Ak je hodnota mimo povoleného rozsahu\\



\textit{public static void \textbf{checkStringNumbersRange}(String min, String max, String value, String dataType)}

Overí, èi èíselná hodnota v re»azci spadá do rozsahu daného dátovým typom. \\
{\bfseries Parametre:}\\
\emph{String} min - dolná hranica rozsahu \\
\emph{String} max - horná hranica rozsahu\\
\emph{String} value - hodnota, ktorá sa má overi»\\
\emph{String} dataType - dátový typ hodnoty\\
{\bfseries Hád¾e:}\\
\verb|OutOfBoundsException| - Ak je hodnota mimo povoleného rozsahu




\subsubsection{Trieda IPFIXFlowRecord}
Táto trieda je reprezentáciou IPFIX Flow record-u, teda záznamu o toku.

\bigskip
\textbf{Kon¹truktor} 

\textit{public \textbf{IPFIXFlowRecord}(IPFIXTemplateRecord referencedTemplate, 
ArrayList $<$IPFIXDataRecord$>$ dataRecords, IPFIXMessage.IPFIXMessageHeader messageHeader)}

Kon¹truktor prostredníctvom predaných parametrov inicializuje èlenské premenné.\\
\textbf{Parametre:}\\
\emph{IPFIXTemplateRecord} referencedTemplate - ¹ablóna patriaca dátovým záznamom\\
\emph{ArrayList$<$IPFIXDataRecord$>$} dataRecords - pole dátových záznamov\\
\emph{IPFIXMessage.IPFIXMessageHeader} messageHeader - hlavièka IPFIX správy, ktorá obsahovala tento
záznam o toku


\emph{public \textbf{IPFIXFlowRecord}()}

Bezparametrický kon¹truktor. Iba inicializuje prázdne pole dátových záznamov. \\


\textbf{Metódy:}\\
Metódy, ktoré tu nie sú spomenuté, sú klasické gettery a settery.



\emph{public int \textbf{getReferencedTemplateID}()}

{\bfseries Návratová hodnota:}\\
Vracia ID ¹ablóny z IPFIX správy, ktorá obsahovala tento záznam o toku.\\



\clearpage
\emph{public void \textbf{addDataRecord}(IPFIXDataRecord dataRecord)}

Pridá dátový záznam do poµa dátových záznamom flow record-u.\\
\textbf{Parametre:}\\
\emph{IPFIXDataRecord} dataRecord - dátový záznam, ktorý sa priradí záznamu o toku.



\subsubsection{Trieda IPFIXMessageHeader}
Trieda reprezentujúca hlavièku IPFIX správy. Implementuje návrhový vzor Singleton.

\bigskip
\textbf{Metody:}\\
Metódy, ktoré tu nie sú spomenuté, sú klasické gettery a settery.

\emph{public static IPFIXMessageHeader \textbf{getInstance}()}

{\bfseries Návratová hodnota:}\\
Vracia jedineènú in¹tanciu objektu.





% ----------BALÍK INTERMEDIATE PROCESS ----------------------------------

\subsection{Balík sk.tuke.cnl.bm.Mediator.IntermediateProcesses}


Diagram tried rozhrania pre sprostredkovateµské procesy, vrátane triedy \verb|ExampleProcess| je znázornený
na obrázku \ref{o:intermediate_class}.

\begin{figure}[ht!]
\centering
\includegraphics[width=1.0\textwidth]{intermediate_class}
\caption{Diagram tried rozhrania pre sprostredkovateµské procesy}\label{o:intermediate_class}
\end{figure}



\subsubsection{Trieda AIntermediateProcess}
Abstraktná trieda, poskytuje východiskové metódy sprostredkovateµským procesom a tvori akési
rozhranie medzi modulmi a aplikaèným rámcom. Dedí od triedy \verb|Thread|.\\
\\
\\

\bigskip
\textbf{Kon¹truktor} 

\emph{\textbf{AIntermediateProcess}(String childName)}

Nastaví meno procesu, podµa prijatého parametra. Inicializuje vstupný buffer a získa jedineènú in¹tanciu
triedy \verb|IPFIXElements|.\\
\textbf{Parametre:}\\
\emph{String} childName - meno triedy potomka

\emph{\textbf{AIntermediateProcess}()}

Bezparametrický kon¹truktor. Inicializuje vstupný buffer a získa jedineènú in¹tanciu
triedy \verb|IPFIXElements|.\\


\textbf{Metody:}\\

\emph{public static final synchronized $<$T extends AIntermediateProcess$>$ T \textbf{getInstance} (Class clazz)}

Toto rie¹enie je hybridom viacerých prístupov, ktoré sa diskutujú na Internete, no vychádza z 
návrhového vzoru \emph{Factory method}. Výsledkom je abstraktná trieda, slú¾iaca ako továreò na 
podtriedy tým, ¾e volá jej statickú metódu \emph{getInstance(Class clazz)}. 
Ak sú splnené podmienky, ¾e konkrétna trieda, napr. \verb|SelectionProcess| je definovaná v rovnakom 
balíèku ako \verb|AIntermediateProcess| a ich kon¹truktory nemajú explicitne nastavený prístup 
(predvoleným prístupom je \uv{privátny v rámci balíèka}), tak 
jediným spôsobom ako získa» in¹tanciu podtriedy mimo balíèka je cez kon¹trukciu:
\begin{verbatim}
 SelectionProcess instance = 
 AIntermediateProcess.getInstance(SelectionProcess.class);
\end{verbatim}
Dalo by sa vyèíta», ¾e vytváranie in¹tancií pou¾íva reflexiu, ktorá je pomalá. Av¹ak, keï¾e vytvárame 
Singletony, volanie \emph{newInstance()} sa vykoná pre ka¾dý modul pravé raz. \\
\textbf{Parametre:}\\
\emph{Class} clazz = class objekt po¾adovanej triedy \\
\textbf{Návratová hodnota:}\\
Objekt typu T, prièom T dedi od \verb|AIntermediateProcess|.



\emph{public static final synchronized $<$T extends AIntermediateProcess$>$ T \textbf{getInstance} (String processName)}
   
Aby bolo mo¾né získava» in¹tancie modulov aj na základe mena triedy a nie len cez class objekty, vytvoril 
som túto metódu. Premennú \emph{processName} prevedie na binárne meno procesu, podµa ¹pecifikácie jazyka 
Java, teda názov triedy vrátane balíèkov, napr. 
\verb|sk.tuke.cnl.Mediator.SelectionProcess|.
Táto metóda naèíta \emph{class} objekt sprostredkovateµského procesu cez systémový class loader,
tak ako to bolo vy¹¹ie spomínané. Potom zavolá pôvodnú metódu \emph{getInstance(Class clazz)} a 
vráti in¹tanciu procesu.\\
\textbf{Parametre:}\\
\emph{String} processName = meno po¾adovanej triedy \\
\textbf{Návratová hodnota:}\\
Objekt typu T, prièom T dedi od \verb|AIntermediateProcess|.\\




\emph{protected final HashMap \textbf{decodeDataRecord}(IPFIXTemplateRecord template, IPFIXDataRecord dataRecord)}

Pri prvom prechode funkciou sa generuje pamä»ový záznam o informaèných elementoch (ie) z XML súboru. 
Vytiahnu sa informácie o ie, ktoré sa nachádzajú v ¹ablóne, dekódujú sa ich dátové typy a príslu¹nos» k 
skupine.\\
\textbf{Parametre:}\\
\emph{IPFIXTemplateRecord} template - ¹ablóna dát\\
\emph{IPFIXDataRecord} dataRecord - dátový záznam\\
\textbf{Návratová hodnota:}\\
Dekódované dáta ako objekt typu \verb|HashMap|.\\


\emph{protected final IPFIXDataRecord \textbf{encodeDataRecord}(IPFIXTemplateRecord template, 
HashMap$<$String, String$>$ dataMap)}

Zakóduje v¹etky hodnoty z hashmapy obsahujúcej hodnoty informaèných elementov podµa ¹ablóny do dátového 
záznamu. \\
\textbf{Parametre:}\\
\emph{IPFIXTemplateRecord} template - ¹ablóna dát \\
\emph{HashMap$<$String, String$>$} dataMap - hodnoty informaèných elementov v hashmape, ktorá sa má zakódova»\\
\textbf{Návratová hodnota:}\\
Vracia objekt dátového záznamu -  \verb|IPFIXDataRecord|.\\
\textbf{Hád¾e:}\\
\verb|EncodingException| - Ak nastane chyba pri kódovaní.\\



\emph{protected final void \textbf{dispatchFlowRecord}(IPFIXFlowRecord flowRecord, String inputProcess)}

Vytvára rozhranie pre prístup k metóde aplikaèného rámca.\\
\textbf{Parametre:}\\
\emph{IPFIXFlowRecord} flowRecord - záznam o toku, ktorý sa má posunú» ïalej \\
\emph{String} inputProcess - pôvodca záznamu o toku 



\subsubsection{Trieda ExampleProcess}

Táto trieda je vzorovým rie¹ením jednoduchého sprostredkovateµského procesu, vykonávajúceho 
anonymizáciu. Úèelom triedy je pomoc ïal¹ej generácii rie¹iteµov.

\bigskip
\textbf{Kon¹truktor} 

\emph{\textbf{ExampleProcess}()}

Vola rodièovský kon¹truktor a predáva mu svoje meno ako parameter.\\

\textbf{Metody:}\\
\emph{public void \textbf{run}()}

Hlavná metóda vlákna. V cykle èaká na záznamy o tokoch vo svojom vstupnom bufferi \emph{(inputBuffer)} a 
postupne ich odtiaµ èíta a odstraòuje. Nazvime ich 
\emph{vstupne záznamy}. Vstupný buffer jej napåòa trieda \verb|FlowRecordDispatcher|. Po preèítaní 
vstupného záznamu vytvorí a inicializuje \emph{výstupný záznam}. Následne prechádza v¹etky dátové záznamy
vstupného záznamu, dekóduje ich, anonymizuje zdrojovú a cieµovú IP adresu a naspa» zakóduje. Ak v¹etko 
prebehlo bez problémov, tak dátový záznam priradí výstupnému záznamu. Napokon výstupný záznam o toku 
posunie distribútorovi záznamov, ktorý ho bude prepo¹le 
nasledujúcemu sprostredkovateµskému procesu, alebo pripraví na export. \\


\emph{private String \textbf{anonymizeIPv4}(String address)}

Metóda na veµmi jednoduchú anonymizáciu IP adresy, èíslo v poslednom oktete zmení na 0.\\
\textbf{Parametre:}\\
\emph{String} address - IP adresa, ktorá sa anonymizova» \\
\textbf{Návratová hodnota:}\\
Anonymizovaná IP adresa, vrátená ako re»azec.



\subsubsection{Trieda IPInputBuffer}

Reprezentuje vstupný buffer sprostredkovateµských modulov. Táto trieda je cache pre záznamy o tokoch. 
Jej pou¾itie je kritické vo vysokorýchlostných sie»ach, preto¾e udr¾iava elementy a tým pádom mô¾e 
vyrovnáva» nárazový nápor. Je synchronizovaná a jej implementácia je FIFO front typu \verb|ArrayBlockingQueue|.\\

\textbf{Metódy:}

\emph{public boolean \textbf{write}(IPFIXFlowRecord flowRecord)}

Zapisuje záznamy o tokoch do frontu. Ak je front plný, záznam sa zahadzuje.\\
\textbf{Parametre:}\\
\emph{IPFIXFlowRecord} flowRecord - záznam o toku\\
\textbf{Návratová hodnota:}\\
Pravdivostná hodnota podµa toho, èi záznam bol, alebo nebol zapísaný do cache.\\


\emph{public void \textbf{write}(IPFIXTemplateRecord template, ArrayList$<$IPFIXDataRecord$>$ dataRecords, IPFIXMessage.IPFIXMessageHeader messageHeader)}

Metóda obalí prijaté parametre do objektu triedy \verb|IPFIXFlowRecord| a zavolá predchádzajúcu metódu.\\
\textbf{Parametre:}\\
\emph{IPFIXTemplateRecord} template - ¹ablóna\\
\emph{ArrayList$<$IPFIXDataRecord$>$} dataRecords - pole dátových záznamov\\
\emph{IPFIXMessage.IPFIXMessageHeader} messageHeader - hlavièka IPFIX správy, z ktorej tento záznam o toku 
pochádza\\



\emph{public IPFIXFlowRecord \textbf{read}()}

Preèíta a zma¾e vrchol frontu. Ak je front prázdny èaká dokiaµ sa tam nejaký element nepridá.\\
\textbf{Návratová hodnota:}\\
Objekt triedy \verb|IPFIXFlowRecord|.\\
\textbf{Hád¾e:}\\
\verb|InterruptedException| - Ak nastala chyba pri synchronizovaní vlákien, alebo ak bolo vlákno preru¹ené 
poèas èakania.



%----------COLLECTING --------------------------------------

\subsection{Balík sk.tuke.cnl.bm.Mediator.collecting}

Zjednodu¹ený diagram tried tohto balíka mô¾eme vidie» na Obr. \ref{o:collecting1_class} a na 
Obr. \ref{o:collecting2_class}.

\begin{figure}[ht!]
\centering
\includegraphics[width=1.0\textwidth]{collecting1_class}
\caption{Diagram tried prvej fázy zhroma¾ïovacieho procesu}\label{o:collecting1_class}
\end{figure}


\subsubsection{Trieda UDPServer}
Slú¾i ako UDP server. Prijíma UDP datagramy cez \verb|DatagramChannel| a ukladá ich do 
\verb|PacketCache|. 

\bigskip
\textbf{Kon¹truktor} 

\textit{public \textbf{UDPServer}(int port)}

Kon¹truktor inicializuje \verb|DatagramChannel|, nastaví mu blokovací re¾im a privia¾e ho k~portu 
definovanom v~konfiguraènom súbore, ktorý mu je predaný ako parameter. Nastaví meno vlákna.\\
\textbf{Parametre:} \\
\emph{int} port - èíslo portu

\bigskip
\textbf{Metódy}

\textit{public void \textbf{run}()}

Hlavná metóda vlákna. Pokiaµ nedôjde k~preru¹eniu, prijíma cez vytvorený kanál dáta od exportéra. 
Prijate dáta obalí do objektu \verb|ByteBuffer| a predá ich spolu s èasom prijatia a IP adresou a 
portom exportéra metóde \emph{write()}, ktorá ich zapí¹e do \verb|PacketCache|.


\textit{public void \textbf{cleanUp}()}

Táto metóda zru¹í èistiace vlákno pre UDP Template Cache. Je volaná pri preru¹ení tohto vlákna.

\begin{figure}[ht!]
\centering
\includegraphics[width=1.0\textwidth]{collecting2_class}
\caption{Diagram tried druhej fázy zhroma¾ïovacieho procesu}\label{o:collecting2_class}
\end{figure}
%---------

\subsubsection{Trieda IpfixParser}
Táto trieda sa pou¾íva na parsovanie IPFIX správ a ich spracovanie. V porovnaní s verziou 
v aplikácii JXColl bola preèistená. Boli vypustené sekcie spracovávajúce TCP a SCTP spojenia. 
Zásadnej¹ia zmena pri¹la na výstupe z triedy. Sparsované dátové záznamy sú zabalené do vytvoreného 
objektu triedy 
\verb|IPFIXFlowRecord|, spolu s príslu¹nou ¹ablónou a hlavièkou prijatej IPFIX správy. Vytvorený 
záznam o toku je spolu s re»azcom predstavujúcim zdroj záznamu (v tomto prípade \uv{exportér})
posunutý triede \verb|FlowRecordDispatcher|.




% --------------------- EXPORTING ---------------------------

\subsection{Balík sk.tuke.cnl.bm.Mediator.exporting}

Diagram tried exportovacieho procesu je na Obr. \ref{o:exporting_class}.

\begin{figure}[ht!]
\centering
\includegraphics[width=1.0\textwidth]{exporting_class}
\caption{Diagram tried exportovacieho procesu}\label{o:exporting_class}
\end{figure}

\subsubsection{Trieda ExportCache}

Analógia k triede \verb|IPInputBuffer|. Reprezentuje exportovaciu cache, ktorá je synchronizovaná a 
jej implementácia je FIFO front typu \verb|ArrayBlockingQueue|.

\textbf{Metódy:}

\emph{public static boolean \textbf{write}(IPFIXFlowRecord flowRecord)}

Zapisuje záznamy o tokoch do frontu. Ak je front plný, záznam sa zahadzuje.\\
\textbf{Parametre:}\\
\emph{IPFIXFlowRecord} flowRecord - záznam o toku\\
\textbf{Návratová hodnota:}\\
Pravdivostná hodnota podµa toho, èi záznam bol, alebo nebol zapísaný do cache.\\



\emph{public static IPFIXFlowRecord \textbf{read}()}

Preèíta a zma¾e vrchol frontu. Ak je front prázdny èaká dokiaµ sa tam nejaký element nepridá.\\
\textbf{Návratová hodnota:}\\
Objekt triedy \verb|IPFIXFlowRecord|.\\
\textbf{Hád¾e:}\\
\verb|InterruptedException| - Ak nastala chyba pri synchronizovaní vlákien, alebo ak bolo vlákno preru¹ené 
poèas èakania.\\



\emph{public static int \textbf{getSize}()}

\textbf{Návratová hodnota:}\\
Vracia poèet elementov v cache.



\subsubsection{Trieda MessageEncoder}

Trieda slú¾i na zakódovanie resp. zabalenie záznamu o toku do IPFIX paketu podµa ¹pecifikácie v RFC 5101 
a RFC 5102.\\
\\

\textbf{Metódy:}


\emph{public static MessageEncoder \textbf{getInstance}()}

\textbf{Návratová hodnota:}\\
Metóda vracia jedineènú in¹tanciu objektu triedy podµa návrhového vzoru \emph{Singleton}.\\



\emph{protected byte[] \textbf{createIPFIXMessage}(IPFIXFlowRecord flowRecord)}

Na základe záznamu o toku vytvára prúd bytov z IPFIX správy. Vola jednotlive metódy, ktoré robia 
èiastkové úlohy ako zakódovanie sád, hlavièky a podobne.\\
\textbf{Parametre:}\\
\emph{IPFIXFlowRecord} flowRecord - záznam o toku\\
\textbf{Návratová hodnota:}\\
Pole bytov prúdu IPFIX správy.\\



\emph{private byte[] \textbf{encodeMessageHeader}(IPFIXMessage.IPFIXMessageHeader header, short length)}

Zakóduje hlavièku IPFIX správy.\\
\textbf{Parametre:}\\
\emph{IPFIXMessage.IPFIXMessageHeader} header - hlavièka, ktorá sa má zakódova»\\
\emph{short} length - celková då¾ka IPFIX správy\\
\textbf{Návratová hodnota:}\\
Pole bytov prúdu hlavièky IPFIX správy.\\



\emph{private byte[] \textbf{encodeTemplateRecord}(IPFIXTemplateRecord templateRecord)}

Zakóduje záznam ¹ablóny.\\
\textbf{Parametre:}\\
\emph{IPFIXTemplateRecord} templateRecord - záznam ¹ablóny, ktorý sa má zakódova»\\
\textbf{Návratová hodnota:}\\
Pole bytov prúdu záznamu ¹ablóny.\\



\emph{private byte[] \textbf{encodeTemplateSet}(byte[] templateRecordBytes)}

Zakóduje sadu ¹ablón.\\
\textbf{Parametre:}\\
\emph{byte[]} templateRecordBytes - pole bytov prúdu záznamov ¹ablóny, ktoré obsahuje sada ¹ablóny\\
\textbf{Návratová hodnota:}\\
Pole bytov prúdu sady ¹ablón.\\



\emph{private byte[] \textbf{encodeDataRecord}(IPFIXDataRecord dataRecord)}

Zakóduje dátový záznam.\\
\textbf{Parametre:}\\
\emph{IPFIXDataRecord} dataRecord - dátový záznam, ktorý sa má zakódova»\\
\textbf{Návratová hodnota:}\\
Pole bytov prúdu dátového záznamu.\\


\emph{private byte[] \textbf{encodeDataSet}(ByteArrayOutputStream dataRecordsStream, int templateID)}

Zakóduje dátovú sadu.\\
\textbf{Parametre:}\\
\emph{ByteArrayOutputStream} dataRecordsStream - prúd bytov dátových záznamov, ktoré obsahuje sada ¹ablóny\\
\emph{int} templateID - ID prislúchajúcej ¹ablóny \\
\textbf{Návratová hodnota:}\\
Pole bytov prúdu dátovej sady.



\emph{private byte[] \textbf{appendByteArray}(byte[] first, byte[] second)}

Pomocná metóda, ktorá na koniec prvého poµa bytov pripojí druhé pole bytov .\\
\textbf{Parametre:}\\
\emph{byte[]} first - prve pole bytov \\
\emph{byte[]} second - druhe pole bytov\\
\textbf{Návratová hodnota:}\\
Pole bytov výsledného poµa.\\


\emph{private short \textbf{getMessageLength}(byte[] templateSetBytes, byte[] dataSetBytes, byte[] optionsTemplateSetStream)}

Vracia celkovú då¾ku IPFIX správy.\\
\textbf{Parametre:}\\
\emph{byte[]} templateSetBytes - pole bytov sady ¹ablón\\
\emph{byte[]} dataSetBytes - pole bytov dátovej sady\\
\emph{byte[]} optionsTemplateSetStream - pole bytov sady ¹ablón mo¾ností\\
\textbf{Návratová hodnota:}\\
Celková då¾ka IPFIX správy, vrátane hlavièky. Návratový typ je \emph{short}.



\subsubsection{Trieda UDPExporter}


Trieda je samostatným vláknom, záznamy o toku èíta z ExportCache. Tie potom po¹le triede 
\verb|MessageEncoder|, ktorá ich zabalí do IPFIX správ. Zakódované správy exportuje kolektoru na IP 
adresu a port, ktoré sú definované v konfiguraènom súbore. \\

\textbf{Kon¹truktor:}

\emph{private \textbf{UDPExporter}()}

Bezparametrický kon¹truktor. Vola rodièovský kon¹truktor s parametrom svojho mena. Potom sa pokúsi 
vytvori» socket pomocou triedy \verb|DatagramSocket|.\\

\textbf{Metódy:}

\emph{public static MessageEncoder \textbf{getInstance}()}

\textbf{Návratová hodnota:}\\
Metóda vracia jedineènú in¹tanciu objektu triedy podµa návrhového vzoru \emph{Singleton}.\\


\emph{public void \textbf{run}()}

Hlavná metóda vlákna. Dokiaµ nie je vlákno preru¹ené, cyklicky èíta záznamy o toku z ExportCache.
Prostredníctvom triedy \verb|MessageEncoder| vytvorí zo záznamu o toku výstupný prúd bytov. 
Ten spolu s då¾kou prúdu, IP adresou a portom zabalí do paketu - objektu triedy \verb|DatagramPacket|.
Vzniknutý paket odo¹le.



% --------------------- EXCEPTIONS ---------------------------

\subsection{Balík sk.tuke.cnl.bm.exceptions}

Balík obsahuje triedy výnimiek ¹pecifických pre Mediátor. V¹etky výnimky dedia od hlavnej triedy 
výnimiek - \verb|MediatorException|.




\clearpage
\section{Preklad programu}

\subsection{Zoznam zdrojových textov}
Zdrojové texty sú k~dispozícii v~prílohe diplomovej práce.

\noindent Sú k~dispozícii tieto zdrojové texty:

\begin{verbatim}
- balík sk.tuke.cnl.bm.Mediator:
   Config.java
   Default.java
   DropsCounter.java
   FlowRecordDispatcher.java
   IPLoader.java
   Mediator.java
   Support.java
- balík sk.tuke.cnl.bm.Mediator.IPFIX:
   ExporterKey.java
   FieldSpecifier.java
   IPFIXDataRecord.java
   IPFIXDecoder.java
   IPFIXElements.java
   IPFIXEncoder.java
   IPFIXFlowRecord.java
   IPFIXMessage.java
   IPFIXOptionsTemplateRecord.java
   IPFIXSet.java
   IPFIXTemplateRecord.java
   IpfixUdpTemplateCache.java
   TemplateHolder.java
- balík sk.tuke.cnl.bm.Mediator.IntermediateProcesses:
   AIntermediateProcess.java
   ExampleProcess.java
   IPInputBuffer.java
- balík sk.tuke.cnl.bm.Mediator.collecting:
   IPFIXParser.java
   PacketCache.java
   PacketObject.java
   UDPProcessor.java
   UDPServer.java
- balík sk.tuke.cnl.bm.Mediator.exporting:
   ExportCache.java
   MessageEncoder.java   
   UDPExporter.java
- balík sk.tuke.cnl.bm.exceptions:
   DataException.java
   DataFormatException.java
   EncodingException.java
   IPLoaderException.java
   MediatorException.java
   OutOfBoundsException.java
   TemplateException.java
\end{verbatim}



\subsection{Po¾iadavky na technické prostriedky pri preklade}

Preklad programu si vy¾aduje nasledovnú hardvérovú konfiguráciu:
\begin{itemize}
  \item CPU Intel Pentium III 1Ghz alebo ekvivalent
  \item operaèná pamä» 256MB
  \item pevný disk s~1GB voµného miesta
  \item sie»ová karta 100Mb/s
\end{itemize}
\noindent




\subsection{Po¾iadavky na programové prostriedky pri preklade}
\begin{itemize}
\item operaèný systém GNU/Linux s~verziou jadra 2.6 a vy¹¹ou 
\item Java Runtime Environment (JRE) verzie 1.7.0\_03 a~vy¹¹ej
\item kni¾nice dodávané na in¹talaènom médiu
\end{itemize}




\subsection{Náväznos» na iné programové produkty}

Program umo¾òuje sprostredkovanie správ medzi meracím/exportovacím procesom a zhroma¾ïovacím procesom 
IPFIX architektúry, ktoré budú následne vyhodnotené príslu¹nými aplikáciami. Je implementáciou 
\emph{(IP Flow Information Export (IPFIX) Mediation Problem)} v architektúre SLAmeter.
Z~toho vyplýva jeho náväznos» na merací/exportovací proces - BEEM a zhroma¾ïovací proces - JXColl 
(alebo iné implementácie týchto procesov).




\subsection{Vlastný preklad}

Preklad programu spoèíva v~nakopírovaní zdrojových súborov a~spustení kompilátora jazyka
Java s~potrebnými parametrami a~parametrom classpath nastaveným na prídavné kni¾nice.
Odporúèa sa pou¾i» vá¹ obµúbený java IDE, kde staèí jednoducho nastavi» verziu JDK na 7.0
alebo vy¹¹ie a~do cesty classpath prida» cesty ku v¹etkým potrebným kni¾niciam. V~prostredí
NetBeans IDE potom staèí kliknú» na tlaèidlo \textit{Clean and Build}.




\subsection{Vytvorenie in¹talaèného DEB súboru}
Staèí spusti» skript \texttt{buildDeb.sh}, ktorý sa nachádza v~prieèinku /deb.

\begin{center}
\texttt{sh buildDeb.sh }
\end{center}

Výstupom tohto skriptu je súbor s~názvom \texttt{debian.deb}, ktorý mô¾me následne premenova» podµa verzie Mediátora 
(napríklad na mediator\_1.0\_i386.deb). 
Tento skript vykonáva nasledovné:

\begin{enumerate}
\item v~prípade, ak neexistuje prieèinok debian, extrahuje ho z~archívu debian.tar.gz, inak tento krok preskoèí
\item skopíruje binárny súbor z~projektu do DEB balíèka (predpokladá sa, ¾e bol program kompilovaný v~Netbeans IDE pomocou Clean and Build tlaèidla)
\item skopíruje konfiguraèný súbor z~projektu do DEB balíèka
\item skopíruje IPFIX definièný súbor z~projektu do DEB balíèka
\item vyma¾e prípadné doèasné súbory z~DEB balíèka
\item vygeneruje MD5 kontrolné súèty pre v¹etky súbory DEB balíèka
\item zabezpeèí maximálnu kompresiu manuálových stránok a changelog súborov
\item skopíruje binárny súbor z~projektu do DEB balíèka a nastaví mu práva na vykonávanie
\item vytvorí samotný DEB balíèek
\item overí ho pomocou programu lintian - ten vypí¹e prípadne varovania a/alebo chyby
\item archivuje vytvorený DEB balíèek do archívu debian.tar.gz
\end{enumerate}

Pred spustením skriptu je nutné skompilova» Mediátor pomocou Netbeans IDE tlaèidlom \textit{Clean and Build}. 
Prípadné zmeny control alebo changelog súboru, manuálových stránok je nutné vykona» ruène. 
Manuálové stránky je vhodné upravi» pomocou programu \textit{GmanEdit} . Po spustení skriptu sa vytvorí 
DEB balíèek s~názvom \texttt{debian.deb}. Ten je vhodné premenova» podµa aktuálnej verzie. 
Vytvorí sa aj archív \texttt{debian.tar.gz}, ktorý obsahuje najaktuálnej¹iu adresárovú ¹truktúru 
DEB balíèka pre budúce vyu¾itie (ak neexistuje prieèinok debian, vytvorí sa extrakciou z~tohto archívu). 
Ak je potrebné len aktualizova» kód, staèí spusti» skript a ten sa o~v¹etko postará, prièom vytvorí aj 
adresár debian. Súbory mo¾no v~òom upravova» a¾ kým nie je v¹etko podµa predstáv. Ak je v¹etko hotové, 
v~Netbeans IDE je potrebné vymaza» prieèinok debian (vykoná sa SVN DELETE, namiesto obyèajného 
odstránenia zo súborového systému) a projekt ''commitnú»''. \citep{jxcoll_sp, ado_dp}


\subsection{Opis známych chýb}
V~súèasnosti nie sú známe ¾iadne vá¾ne chyby.


\newpage
\section{Zhodnotenie rie¹enia}
%Hlavným cieµom práce bolo zvý¹i» interoperabilitu s~inými IPFIX rie¹eniami pomocou zvý¹enia konformity so ¹tandardom IPFIX. 
%V~práci boli vyrie¹ené problémy, ktoré doteraz znemo¾òovali dekódovanie viacerých záznamov sade, informaèncých elementov s~variabilnou då¾kou, informaèných elementov s~redukovaným kódovaním alebo niektorých predtým neimplementovaných dátových typov. 
%
%Súèas»ou práce bolo roz¹írenie podpory prenosu údajov o~tokoch prostredníctvom transportných protokolov TCP a SCTP, èo zvy¹uje mo¾nosti
%nasadenia nástroja BasicMeter aj v~podmienkach s~vy¹¹ou náchylnos»ou na pre»a¾enie v~sietí. 
%
%Mo¾nosti budúceho vývoja zhroma¾ïovacieho procesu nástroja BasicMeter predstavuje implementácia podpory pre dátové typy umo¾òujúce
%prenos ¹truktúrovaných dát a podpora pre zabezpeèené pripojenia od exportérov.
%


\clearpage
\addcontentsline{toc}{section}{\numberline{}Zoznam pou¾itej literatúry}
\begin{thebibliography}{999}

\harvarditem{Sadasivan, et al.}{2009}{rfc5470}
SADASIVAN, G. et al.: \emph{Architecture for IP Flow Information Export} 
RFC 5470. 2009

\harvarditem{Kobayashi, Claise}{2010}{rfc5982}
KOBAYASHI, A. -- CLAISE, B. et al.: \emph{IP Flow Information Export (IPFIX) Mediation: Problem Statement.} 
RFC 5982. 2010

\harvarditem{Kobayashi et al.}{2011}{rfc6183}
KOBAYASHI, A. et al.: \emph{IP Flow Information Export (IPFIX) Mediation: Framework.} 
RFC 6183. 2011

\harvarditem{Claise}{2004}{rfc3954}
CLAISE, B.: \emph{Cisco Systems NetFlow Services Export Version 9.} 
RFC 3954. 2004

\harvarditem{Vere¹èák}{2012}{jxcoll_sp}
VERE©ÈÁK, T.: Optimalizácia zhroma¾ïovacieho procesu nástroja BasicMeter, 2012,
Diplomová práca, Príloha A, Systémová príruèka JXColl v3.9, KPI FEI TU, Ko¹ice

\harvarditem{Pekár}{2009}{ado_bc}
PEKÁR, A.: Meranie prevádzkových parametrov siete v~reálnom èase, 2009,
Bakalárska práca, KPI FEI TU, Ko¹ice

\harvarditem{Pekár}{2011}{ado_dp}
PEKÁR, A.: Optimalizácia zhroma¾ïovacieho procesu nástroja BasicMeter, 2011,
Diplomová práca, KPI FEI TU, Ko¹ice

\end{thebibliography}